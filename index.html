<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Text Editor - Fast, Clean & Simple Notepad in Your Browser</title>

    <meta name="description" content="A fast, minimal, and modern online text editor for temporary notes, copy-paste, or quick text editing. No login, no clutter – just write.">

    <meta name="keywords" content="online text editor, online notepad, paste and edit text, temporary text editor, simple text editor, fast online editor, clean notepad, browser text editor">

    <meta name="author" content="Kimkorng Mao">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Online Text Editor - Fast, Clean & Simple Notepad">
    <meta property="og:description" content="No signup, no ads – just a modern browser-based text editor for quick editing and note-taking.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://txt.kimkorngmao.com">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class'
      }
    </script>
    <style>
      /* Custom scrollbar styles */
      #editor::-webkit-scrollbar, #line-numbers::-webkit-scrollbar {
        width: 12px;
        height: 12px;
      }
      
      /* Track */
      #editor::-webkit-scrollbar-track, #line-numbers::-webkit-scrollbar-track {
        background: transparent;
      }
      
      /* Handle */
      #editor::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 6px;
        border: 3px solid rgba(0, 0, 0, 0);
        background-clip: padding-box;
      }
      
      #line-numbers::-webkit-scrollbar-thumb {
        background: transparent;
      }
      
      /* Handle on hover */
      #editor::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
        border: 3px solid rgba(0, 0, 0, 0);
        background-clip: padding-box;
      }
      
      /* Dark mode scrollbar */
      .dark #editor::-webkit-scrollbar-thumb {
        background: #4b5563;
      }
      
      .dark #editor::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
      
      /* Editor and line numbers styling */
      #editor {
        scrollbar-width: thin;
        scrollbar-color: #c1c1c1 transparent;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      
      .dark #editor {
        scrollbar-color: #4b5563 transparent;
      }
      
      #line-numbers {
        scrollbar-width: none;
      }
      
      #line-numbers::-webkit-scrollbar {
        display: none;
      }

      /* Ensure consistent line height in editor */
      #editor div, #editor p {
        margin: 0;
        padding: 0;
        min-height: 1em;
      }
      
      /* Fix for empty lines to maintain consistent height */
      #editor div:empty, #editor p:empty, #editor br {
        min-height: 1.5em;
        line-height: 1.5em;
        display: block;
      }
    </style>
  </head>
  <body class="bg-green-50 dark:bg-gray-800">
    <div class="h-screen max-h-screen flex flex-col dark:bg-gray-900 dark:text-gray-100 max-w-7xl mx-auto border boder-gray-100 dark:border-gray-700" id="main-container">
      <!-- Header Menu -->
      <div class="flex justify-between items-center border-b border-gray-100 dark:border-gray-700 text-sm bg-white dark:bg-gray-800" id="menu-bar">
        <div class="flex">
          <div class="relative">
            <button onclick="toggleDropdown('file-menu')" class="px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">File</button>
            <div id="file-menu" class="absolute top-7 left-0 w-48 hidden bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-10">
              <button onclick="document.getElementById('file-input').click()" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Open</span>
                <span class="text-gray-400">Ctrl+O</span>
              </button>
              <input id="file-input" type="file" onchange="openFile(event)" class="hidden" />
              <button onclick="downloadText()" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Download</span>
                <span class="text-gray-400">Ctrl+S</span>
              </button>
            </div>
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('edit-menu')" class="px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">Edit</button>
            <div id="edit-menu" class="absolute top-7 left-0 w-48 hidden bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-10">
              <button onclick="editorCommand('undo')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Undo</span>
                <span class="text-gray-400">Ctrl+Z</span>
              </button>
              <button onclick="editorCommand('redo')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Redo</span>
                <span class="text-gray-400">Ctrl+Y</span>
              </button>
              <button onclick="editorCommand('cut')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Cut</span>
                <span class="text-gray-400">Ctrl+X</span>
              </button>
              <button onclick="editorCommand('copy')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Copy</span>
                <span class="text-gray-400">Ctrl+C</span>
              </button>
              <button onclick="editorCommand('paste')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Paste</span>
                <span class="text-gray-400">Ctrl+V</span>
              </button>
              <button onclick="editorCommand('selectAll')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Select All</span>
                <span class="text-gray-400">Ctrl+A</span>
              </button>
            </div>
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('font-menu')" class="px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">Font</button>
            <div id="font-menu" class="absolute top-7 left-0 w-48 hidden bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-10">
              <button onclick="setFont('Arial, sans-serif')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Arial, sans-serif">Arial</button>
              <button onclick="setFont('Courier New, monospace')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Courier New, monospace">Courier New</button>
              <button onclick="setFont('Georgia, serif')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Georgia, serif">Georgia</button>
              <button onclick="setFont('Times New Roman, serif')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Times New Roman, serif">Times New Roman</button>
              <button onclick="setFont('Verdana, sans-serif')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Verdana, sans-serif">Verdana</button>
              <button onclick="setFont('Consolas, monospace')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer" style="font-family: Consolas, monospace">Consolas</button>
              <button onclick="setFont('')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">Default Font</button>
            </div>
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('view-menu')" class="px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">View</button>
            <div id="view-menu" class="absolute top-7 left-0 w-48 hidden bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-10">
              <button onclick="adjustFontSize(1)" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Zoom In</span>
                <span class="text-gray-400">Ctrl++</span>
              </button>
              <button onclick="adjustFontSize(-1)" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Zoom Out</span>
                <span class="text-gray-400">Ctrl+-</span>
              </button>
              <button onclick="resetFontSize()" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span>Reset Size</span>
                <span class="text-gray-400">Ctrl+0</span>
              </button>
              <button onclick="toggleLineNumbers()" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer flex justify-between">
                <span id="line-numbers-toggle-text">Show Line</span>
                <span class="text-gray-400">Ctrl+L</span>
              </button>
            </div>
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('system-menu')" class="px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">System</button>
            <div id="system-menu" class="absolute top-7 left-0 w-48 hidden bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-10">
              <button onclick="setTheme('light')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">Light Mode</button>
              <button onclick="setTheme('dark')" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-600 cursor-pointer">Dark Mode</button>
            </div>
          </div>
        </div>
        <div class="px-3 py-1">
          <button id="fullscreen-btn" onclick="toggleFullScreen()" class="rounded transition text-gray-700 dark:text-gray-100 focus:outline-none flex items-center justify-center hidden lg:flex" aria-label="Toggle Full Screen" title="Full Screen"></button>
        </div>
      </div>

      <!-- Textarea with Line Numbers -->
      <div class="flex flex-1 min-h-0">
        <div class="flex flex-1 min-h-0 w-full">
          <div id="editor-container" class="flex flex-1 min-h-0 w-full overflow-hidden border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900">
            <div id="line-numbers" class="select-none text-right pr-2 py-4 text-gray-400 dark:text-gray-600 overflow-hidden hidden" style="min-width:2.5rem; background:inherit; font-family:inherit;"></div>
            <div id="editor" contenteditable="true" class="w-full flex-1 p-4 outline-none overflow-auto bg-white dark:bg-gray-900 dark:text-gray-100" style="min-height:100%; font-family:inherit;"></div>
          </div>
        </div>
      </div>

      <!-- Footer Bar -->
      <div class="flex justify-between p-2 text-sm border-t bg-gray-100 dark:bg-gray-800 dark:border-gray-700">
        <div id="status"><a href="https://kimkorngmao.com" target="_blank" class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200">© kimkorngmao.com</a></div>
        <div id="counts">Words: 0 | Chars: 0</div>
      </div>
    </div>

    <script>
      const editor = document.getElementById('editor');
      const status = document.getElementById('status');
      const counts = document.getElementById('counts');
      const lineNumbers = document.getElementById('line-numbers');
      let fontSize = 16;
      let lineNumbersVisible = false;

      // SVGs for fullscreen and exit
      const fullscreenSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M2 4.00087C2 3.44811 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44463 22 4.00087V17.9991C22 18.5519 21.5447 19 21.0082 19H2.9918C2.44405 19 2 18.5554 2 17.9991V4.00087ZM4 5V17H20V5H4ZM5 20H19V22H5V20Z"></path></svg>`;
      const exitFullscreenSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M4 16H20V5H4V16ZM13 18V20H17V22H7V20H11V18H2.9918C2.44405 18 2 17.5511 2 16.9925V4.00748C2 3.45107 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44892 22 4.00748V16.9925C22 17.5489 21.5447 18 21.0082 18H13Z"></path></svg>`;

      // --- KEYBOARD SHORTCUTS ---
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'o':
              e.preventDefault();
              document.getElementById('file-input').click();
              break;
            case 's':
              e.preventDefault();
              downloadText();
              break;
            case '+':
            case '=':
              e.preventDefault();
              adjustFontSize(1);
              break;
            case '-':
              e.preventDefault();
              adjustFontSize(-1);
              break;
            case '0':
              e.preventDefault();
              resetFontSize();
              break;
            case 'l':
              e.preventDefault();
              toggleLineNumbers();
              break;
          }
        }
      });

      // --- THEME: Load theme from localStorage on page load ---
      function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }
      loadTheme();

      // --- EDITOR CONTENT: Load from localStorage on page load ---
      function loadEditorContent() {
        const savedContent = localStorage.getItem('editorContent');
        if (savedContent !== null) {
          // Use innerHTML to preserve formatting but be careful with XSS in production
          editor.innerHTML = savedContent;
        }
      }
      loadEditorContent();

      // --- FONT SIZE: Load from localStorage on page load ---
      function loadFontSize() {
        const savedFontSize = localStorage.getItem('editorFontSize');
        if (savedFontSize) {
          fontSize = parseInt(savedFontSize);
        } else {
          fontSize = 16;
        }
        editor.style.fontSize = fontSize + 'px';
        lineNumbers.style.fontSize = fontSize + 'px';
        updateLineNumbers();
      }
      loadFontSize();

      // --- LINE NUMBERS VISIBILITY: Load from localStorage on page load ---
      function loadLineNumbersVisibility() {
        const savedVisibility = localStorage.getItem('lineNumbersVisible');
        lineNumbersVisible = savedVisibility === 'true';
        updateLineNumbersVisibility();
      }
      loadLineNumbersVisibility();

      // --- FONT FAMILY: Load from localStorage on page load ---
      function loadFontFamily() {
        const savedFontFamily = localStorage.getItem('editorFontFamily');
        if (savedFontFamily) {
          editor.style.fontFamily = savedFontFamily;
          lineNumbers.style.fontFamily = savedFontFamily;
        }
      }
      loadFontFamily();

      // --- IMPROVED LINE NUMBER SYSTEM ---
      function getLineCount() {
        // Create a temporary clone of the editor to measure wrapped lines
        const tempDiv = document.createElement('div');
        tempDiv.style.position = 'absolute';
        tempDiv.style.visibility = 'hidden';
        tempDiv.style.width = editor.clientWidth + 'px'; // Same width as editor
        tempDiv.style.fontSize = fontSize + 'px';
        tempDiv.style.fontFamily = editor.style.fontFamily || 'inherit';
        tempDiv.style.whiteSpace = 'pre-wrap';
        tempDiv.style.wordWrap = 'break-word';
        
        // Clone the content
        tempDiv.innerHTML = editor.innerHTML;
        document.body.appendChild(tempDiv);
        
        // Count the actual visual lines by measuring height
        const lineHeight = parseInt(window.getComputedStyle(editor).lineHeight) || Math.floor(fontSize * 1.5);
        const totalHeight = tempDiv.scrollHeight;
        const lineCount = Math.ceil(totalHeight / lineHeight);
        
        // Clean up
        document.body.removeChild(tempDiv);
        
        // Ensure at least one line is always returned
        return Math.max(1, lineCount);
      }

      function updateLineNumbers() {
        if (!lineNumbersVisible) return;

        const lineCount = getLineCount();
        const comp = window.getComputedStyle(editor);
        const lh = comp.lineHeight === 'normal' 
          ? Math.floor(fontSize * 1.5) 
          : parseInt(comp.lineHeight, 10);

        // Build line numbers HTML
        let html = '';
        for (let i = 1; i <= lineCount; i++) {
          html += `<div style="height:${lh}px; line-height:${lh}px;">${i}</div>`;
        }

        lineNumbers.innerHTML = html;
        lineNumbers.scrollTop = editor.scrollTop;
      }

      function setupLineNumberEvents() {
        // Update on content changes
        const observer = new MutationObserver(() => {
          ensureConsistentLineHeight();
          updateLineNumbers();
          updateCounts();
        });
        
        observer.observe(editor, {
          childList: true,
          subtree: true,
          characterData: true
        });

        // Update on these events
        const updateEvents = ['scroll', 'click', 'keyup', 'mouseup', 'paste'];
        updateEvents.forEach(event => {
          editor.addEventListener(event, () => {
            setTimeout(() => {
              ensureConsistentLineHeight();
              updateLineNumbers();
              updateCounts();
            }, 0);
          });
        });

        // Special paste handling
        editor.addEventListener('paste', function(e) {
          e.preventDefault();
          const text = (e.clipboardData || window.clipboardData).getData('text/plain');
          document.execCommand('insertText', false, text);
        });
      }

      // New function to ensure consistent line height
      function ensureConsistentLineHeight() {
        const comp = window.getComputedStyle(editor);
        const lh = comp.lineHeight === 'normal' 
          ? Math.floor(fontSize * 1.5) + 'px'
          : comp.lineHeight;
          
        // Apply consistent line height to all elements
        Array.from(editor.childNodes).forEach(node => {
          if (node.nodeType === Node.ELEMENT_NODE) {
            node.style.minHeight = lh;
            node.style.lineHeight = lh;
          } else if (node.nodeType === Node.TEXT_NODE && node.textContent.trim() === '') {
            // Replace empty text nodes with a div to maintain height
            const div = document.createElement('div');
            div.style.minHeight = lh;
            div.style.lineHeight = lh;
            node.parentNode.replaceChild(div, node);
          }
        });
        
        // If editor is empty, add a div to maintain height
        if (editor.childNodes.length === 0 || 
            (editor.childNodes.length === 1 && 
             editor.childNodes[0].nodeType === Node.TEXT_NODE && 
             editor.childNodes[0].textContent.trim() === '')) {
          editor.innerHTML = '<div style="min-height:' + lh + '; line-height:' + lh + ';"></div>';
        }
      }
      function initLineNumbers() {
        loadLineNumbersVisibility();
        setupLineNumberEvents();
        updateLineNumbers();
      }

      function setFont(fontFamily) {
        editor.style.fontFamily = fontFamily;
        lineNumbers.style.fontFamily = fontFamily;
        localStorage.setItem('editorFontFamily', fontFamily);
        updateLineNumbers();
      }

      function adjustFontSize(change) {
        fontSize = Math.max(10, Math.min(32, fontSize + change));
        editor.style.fontSize = fontSize + 'px';
        lineNumbers.style.fontSize = fontSize + 'px';
        localStorage.setItem('editorFontSize', fontSize.toString());
        updateLineNumbers();
      }

      function resetFontSize() {
        fontSize = 16;
        editor.style.fontSize = fontSize + 'px';
        lineNumbers.style.fontSize = fontSize + 'px';
        localStorage.setItem('editorFontSize', fontSize.toString());
        updateLineNumbers();
      }

      function toggleLineNumbers() {
        lineNumbersVisible = !lineNumbersVisible;
        localStorage.setItem('lineNumbersVisible', lineNumbersVisible.toString());
        updateLineNumbersVisibility();
        updateLineNumbers();
      }

      function updateLineNumbersVisibility() {
        const toggleText = document.getElementById('line-numbers-toggle-text');
        if (lineNumbersVisible) {
          lineNumbers.classList.remove('hidden');
          toggleText.textContent = 'Hide Line';
        } else {
          lineNumbers.classList.add('hidden');
          toggleText.textContent = 'Show Line';
        }
      }

      function updateCounts() {
        const text = editor.innerText;
        const words = text.trim().split(/\s+/).filter(Boolean).length;
        const chars = text.length;
        counts.textContent = `Words: ${words} | Chars: ${chars}`;
        // Save the content to localStorage
        localStorage.setItem('editorContent', editor.innerHTML);
      }

      function updateCursorInfo() {
        status.textContent = '';
      }

      function downloadText() {
        const blob = new Blob([editor.innerText], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'note.txt';
        link.click();
      }

      function openFile(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            editor.innerHTML = reader.result.replace(/\n/g, '<br>');
            localStorage.setItem('editorContent', editor.innerHTML);
            updateCounts();
            updateCursorInfo();
            updateLineNumbers();
          };
          reader.readAsText(file);
        }
      }

      function setTheme(mode) {
        if (mode === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
        localStorage.setItem('theme', mode);
      }

      function editorCommand(cmd) {
        editor.focus();
        
        if (cmd === 'paste') {
          if (navigator.clipboard && navigator.clipboard.readText) {
            navigator.clipboard.readText().then(text => {
              document.execCommand('insertText', false, text);
              updateCounts();
              updateLineNumbers();
            }).catch(err => {
              document.execCommand('paste');
              setTimeout(() => {
                updateCounts();
                updateLineNumbers();
              }, 0);
            });
          } else {
            document.execCommand('paste');
            setTimeout(() => {
              updateCounts();
              updateLineNumbers();
            }, 0);
          }
          return;
        }
        
        switch (cmd) {
          case 'undo':
            document.execCommand('undo');
            break;
          case 'redo':
            document.execCommand('redo');
            break;
          case 'cut':
            document.execCommand('cut');
            break;
          case 'copy':
            document.execCommand('copy');
            break;
          case 'selectAll':
            document.execCommand('selectAll');
            break;
        }
        
        setTimeout(() => {
          updateCounts();
          updateLineNumbers();
        }, 0);
      }

      function toggleDropdown(id) {
        const dropdowns = ['file-menu', 'edit-menu', 'font-menu', 'view-menu', 'system-menu'];
        dropdowns.forEach(menuId => {
          const el = document.getElementById(menuId);
          if (el) {
            if (menuId === id) {
              el.classList.toggle('hidden');
            } else {
              el.classList.add('hidden');
            }
          }
        });
      }

      document.addEventListener('click', function(event) {
        const menuBar = document.getElementById('menu-bar');
        if (!menuBar.contains(event.target)) {
          ['file-menu', 'edit-menu', 'font-menu', 'view-menu', 'system-menu'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
          });
        }
      });

      // Scroll sync between editor and line numbers
      editor.addEventListener('scroll', function() {
        lineNumbers.scrollTop = editor.scrollTop;
      });

      function setFullScreenState(isFull) {
        const main = document.getElementById('main-container');
        const btn = document.getElementById('fullscreen-btn');
        const classes = ['max-w-7xl', 'mx-auto', 'border', 'boder-gray-100'];
        if (isFull) {
          main.classList.remove(...classes);
          btn.innerHTML = exitFullscreenSVG;
          btn.title = 'Exit Full Screen';
          localStorage.setItem('fullscreen', '1');
        } else {
          main.classList.add(...classes);
          btn.innerHTML = fullscreenSVG;
          btn.title = 'Full Screen';
          localStorage.setItem('fullscreen', '0');
        }
      }

      function isLargeScreen() {
        return window.innerWidth >= 1024;
      }

      function toggleFullScreen() {
        if (!isLargeScreen()) {
          const btn = document.getElementById('fullscreen-btn');
          btn.title = 'Full Screen is only available on large screens';
          btn.blur();
          return;
        }
        const main = document.getElementById('main-container');
        const classes = ['max-w-7xl', 'mx-auto', 'border', 'boder-gray-100'];
        const isFull = classes.every(cls => !main.classList.contains(cls));
        setFullScreenState(!isFull);
      }

      window.addEventListener('resize', () => {
        const btn = document.getElementById('fullscreen-btn');
        if (!isLargeScreen()) {
          btn.title = 'Full Screen is only available on large screens';
        } else {
          const main = document.getElementById('main-container');
          const classes = ['max-w-7xl', 'mx-auto', 'border', 'boder-gray-100'];
          const isFull = classes.every(cls => !main.classList.contains(cls));
          btn.title = isFull ? 'Exit Full Screen' : 'Full Screen';
        }
        updateLineNumbers();
      });

      window.addEventListener('DOMContentLoaded', () => {
        const isFull = localStorage.getItem('fullscreen') === '1';
        setFullScreenState(isFull);
        initLineNumbers();
        updateCounts();
      });
    </script>
  </body>
</html>